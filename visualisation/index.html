<!DOCTYPE html>
<html lang="en">
<head>
    <meta content="utf-8" http-equiv="encoding">
    <title>D3: Setting path fills dynamically to generate a choropleth</title>
    <script type="text/javascript" src="./lib/d3/d3.v3.min.js" charset="utf-8"></script>
    <style type="text/css">
        /* No style rules here yet */
    </style>
</head>
<body>
<script type="text/javascript">
    //Width and height
    var w = 2000;
    var h = 800;
    //Define map projection
    var projection = d3.geo.albersUsa()
            .translate([w / 2, h / 2])
            .scale([1500]);
    //Define path generator
    var path = d3.geo.path()
            .projection(projection);

    //Define quantize scale to sort data values into buckets of color
    var color = d3.scale.quantize()
            .range(["rgb(237,248,233)", "rgb(186,228,179)", "rgb(116,196,118)", "rgb(49,163,84)", "rgb(0,109,44)"]);
    //Colors taken from colorbrewer.js, included in the D3 download
    //Create SVG element
    var svg = d3.select("body")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

    // Append Div for tooltip to SVG
    var div = d3.select("body")
            .append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);

    //Load in GeoJSON data
    d3.json("us-states.json", function (json) {
        //Bind data and create one path per GeoJSON feature
        svg.selectAll("path")
                .data(json.features)
                .enter()
                .append("path")
                .attr("d", path)
                .style("fill", function (d) {
                    //Get data value
                    var value = d.properties.value;

                    if (value) {
                        //If value exists…
                        return color(value);
                    } else {
                        //If value is undefined…
                        return "#ccc";
                    }
                });


        // Map the cities I have lived in!
        d3.csv("plant_data.csv", function (data) {

            svg.selectAll("circle")
                    .data(data)
                    .enter()
                    .append("circle")
                    .attr("cx", function (d) {
                        return projection([d.lon, d.lat])[0];
                    })
                    .attr("cy", function (d) {
                        return projection([d.lon, d.lat])[1];
                    })
                    .attr("r", function (d) {
                        return 5;
                    })
                    .style("fill", "rgb(217,91,67)")
                    .style("opacity", 0.85)

                    // Modification of custom tooltip code provided by Malcolm Maclean, "D3 Tips and Tricks"
                    // http://www.d3noob.org/2013/01/adding-tooltips-to-d3js-graph.html
                    .on("mouseover", function (d) {
                        div.transition()
                                .duration(200)
                                .style("opacity", .9);
                        div.text(d.id)
                                .style("left", (d3.event.pageX) + "px")
                                .style("top", (d3.event.pageY - 28) + "px");
                    })

                    // fade out tooltip on mouse out
                    .on("mouseout", function (d) {
                        div.transition()
                                .duration(500)
                                .style("opacity", 0);
                    })
                    .on("tick",function(d) {
                        d3.select(this).attr("r",function(d) {
                            console.log(d3.select(this).attr("r"));
                            return parseInt(d3.select(this).attr("r"))+1;
                        })
                    });
        });

    });


</script>
</body>
</html>